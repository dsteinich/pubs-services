<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:sec="http://www.springframework.org/schema/security" xmlns:util="http://www.springframework.org/schema/util"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:jee="http://www.springframework.org/schema/jee"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
						   http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd">

	<sec:global-method-security	secured-annotations="enabled" proxy-target-class="true" />

	<sec:http auto-config="false" create-session="stateless" entry-point-ref="unauthorizedEntryPoint" use-expressions="true">
		<sec:custom-filter ref="tokenSecurityFilter" position="FORM_LOGIN_FILTER"/>
		<sec:intercept-url pattern="/**" method="OPTIONS" access="isAnonymous()" requires-channel="https"/>
		<sec:intercept-url pattern="/auth/token" access="isAnonymous()" requires-channel="https" />
		<sec:intercept-url pattern="/auth/logout" access="isAuthenticated()" requires-channel="https" />
		<sec:intercept-url pattern="/lookup/**" access="isAnonymous()" requires-channel="https" />
		<sec:intercept-url pattern="/mppublications/*/preview*" access="hasAnyRole('AD_AUTHENTICATED','PUBS_AUTHORIZED')" requires-channel="https" />
		<sec:intercept-url pattern="/publication/**" access="isAnonymous()" requires-channel="https" />
		<sec:intercept-url pattern="/version" access="isAnonymous()" requires-channel="https" />
		<sec:intercept-url pattern="/**" access="hasRole('PUBS_AUTHORIZED')" requires-channel="https" />
		<sec:anonymous />
	</sec:http>

	<bean id="authClient" class="gov.usgs.cida.auth.client.CachingAuthClient">
		<constructor-arg ref="authService" />
	</bean>

	<bean id="tokenSecurityFilter" class="gov.usgs.cida.pubs.webservice.security.TokenSecurityFilter"/>

	<bean id="unauthorizedEntryPoint" class="gov.usgs.cida.pubs.webservice.security.UnauthorizedEntryPoint"/>

	<sec:authentication-manager>
		<sec:authentication-provider ref="pubsAuthenticationProvider"/>
	</sec:authentication-manager>
	
	<bean id="pubsAuthenticationProvider" class="gov.usgs.cida.pubs.webservice.security.PubsAuthenticationProvider"/>
	<bean id="authenticationService" class="gov.usgs.cida.pubs.webservice.security.AuthenticationService"/>

</beans>
